(this.webpackJsonpmitekScienceSDK=this.webpackJsonpmitekScienceSDK||[]).push([[6],{160:function(e,t){},163:function(e,t){},181:function(e,t){},182:function(e,t){},278:function(e,t,n){"use strict";n.r(t),n.d(t,"processFrame",function(){return Z});var r=n(1),a=n(2),i=n(10),o=n(188),u=n.n(o),c=n(189),s=n(39);function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t,n,r,a,i,o){try{var u=e[i](o),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var i=e.apply(t,n);function o(e){A(i,r,a,o,u,"next",e)}function u(e){A(i,r,a,o,u,"throw",e)}o(void 0)})}}var E=Object(i.a)(),S=160,g=70,d=.33,O=1.6,m=10,N=5,I=60,l=120,D=5,p="",y=!1,x=new c.a({inputSize:160,scoreThreshold:.4}),w=document.createElement("canvas"),P=document.createElement("canvas"),M={ranOnce:!1},b=90;r.a.on("ORIENTATION_AXIS_CHANGE",function(e){b=e});var T=w.getContext("2d"),v=P.getContext("2d"),C={},F=!1,L=new ImageData(10,10),R=0,U=0,H=0,k="",B="",G=0,W={MISNAP_HEAD_TOO_CLOSE:0,MISNAP_HEAD_OUTSIDE:0,MISNAP_STAY_STILL:0,MISNAP_AXIS_ANGLE:0,MISNAP_HEAD_SKEWED:0,MISNAP_HEAD_TOO_FAR:0,NO_FACE_FOUND:0};function K(e,t,n){return new Promise(function(r){setTimeout(function(){P.width=t,P.height=n,v.save(),v.clearRect(0,0,P.width/4,P.height),v.translate(P.width/2,P.height/2),v.rotate(e*Math.PI/180),v.drawImage(w,-P.width/2,-P.height/2),v.translate(-P.width/2,-P.height/2),v.restore(),r(P)},10)})}function j(){return(j=f(regeneratorRuntime.mark(function e(t,n){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,w.width=t.imageData.width,w.height=t.imageData.height,T.putImageData(t.imageData,0,0),"MANUAL_CAPTURE"!==n){e.next=26;break}return c.f.setBackend("cpu"),a=t.imageData.width>t.imageData.height,e.next=9,c.b(w,x).withFaceLandmarks(!0).withFaceExpressions();case 9:if(r=e.sent,!q(r)){e.next=14;break}return e.abrupt("return",new Promise(function(e,t){setTimeout(function(){e(r)},50)}));case 14:if(!0!==a){e.next=19;break}return e.next=17,K(-90,t.imageData.width,t.imageData.height);case 17:e.next=20;break;case 19:P=w;case 20:return e.next=22,c.b(P,x).withFaceLandmarks(!0).withFaceExpressions();case 22:return r=e.sent,e.abrupt("return",new Promise(function(e,t){setTimeout(function(){e(r)},50)}));case 24:e.next=32;break;case 26:return c.f.setBackend("webgl"),ee()&&(console.log("IE Detected"),c.f.ENV.set("WEBGL_PACK",!1)),e.next=30,c.b(w,x).withFaceLandmarks(!0).withFaceExpressions();case 30:return r=e.sent,e.abrupt("return",new Promise(function(e,t){setTimeout(function(){e(r)},50)}));case 32:case"end":return e.stop()}},e)}))).apply(this,arguments)}function V(){return(V=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.e.tinyFaceDetector.load(s.a.getPublicWP());case 2:return e.next=4,c.c(s.a.getPublicWP());case 4:return e.next=6,c.d(s.a.getPublicWP());case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}var J,X=(J={x:0,y:0},function(e){var t=0==J.x?e._x:J.x,n=e._x,r=0==J.y?e._y:J.y,a=e._y,i=Math.abs(n-t),o=Math.abs(a-r);return J.x=e._x,J.y=e._y,i>70||o>70});function Y(e){if(!(e&&e.getNose()&&e.getLeftEye()&&e.getRightEye()))return!1;var t=e.getMouth()[0]._x-e.getJawOutline()[4]._x,n=e.getJawOutline()[12]._x-e.getMouth()[6]._x,r=e.getLeftEyeBrow()[0]._x-e.getJawOutline()[0]._x,a=e.getJawOutline()[16]._x-e.getRightEyeBrow()[4]._x;return r<N||a<N||t<m||n<m}var z=function(e){var t,n,r,i=e.faceDetectionWithBox,o=i.expressions.asSortedArray()[0].expression,u=h(i.detection.box)?i.detection.box:i.detectionResult.box,c={type:"MISNAP_HEAD_OUTSIDE",storeFrame:!1,detectionBox:u},s=(n=C,(t=u)._x+S>n.x&&t._x+t._width<n.x+n.width+S&&t._y>n.y&&t._y+t._height<n.y+n.height+g);if(function(e,t){return e.width*e.height/(t.width*t.height)>O}(u,C))return W.MISNAP_HEAD_TOO_CLOSE+=1,c.type="MISNAP_HEAD_TOO_CLOSE",c;if(s){if(Object(a.c)()&&!1===F&&((r=b)<I||r>l))return W.MISNAP_AXIS_ANGLE+=1,c.type="MISNAP_AXIS_ANGLE",c;if(X(u))return W.MISNAP_STAY_STILL+=1,c.type="MISNAP_STAY_STILL",c;if(Y(i.landmarks))return W.MISNAP_HEAD_SKEWED+=1,c.type="MISNAP_HEAD_SKEWED",c;if(function(e,t){return e.width*e.height/(t.width*t.height)<d}(u,C))return W.MISNAP_HEAD_TOO_FAR+=1,c.type="MISNAP_HEAD_TOO_FAR",c;var _="neutral"===o||"sad"===o;return R="happy"===o||"surprised"===o?R+1:R,c.storeFrame=_,R>1&&""===k&&(k=!0),""!==B&&""!==k?(R=0,U=0,k="",B="",c.type="MISNAP_SUCCESS",c):""===B&&""!==k?(c.type="MISNAP_STOP_SMILING",c):""===k?(c.type="MISNAP_SMILE",c):(c.type="MISNAP_READY_POSE",c)}return W.MISNAP_HEAD_OUTSIDE+=1,c.type="MISNAP_HEAD_OUTSIDE",c},q=function(e){return void 0!==e&&e},Q=null,Z=function(e){p=e.captureMode,function(e,t){return j.apply(this,arguments)}(e,p).then(function(e){return q(e)}).then(function(e){return!!(!1!==(t=e)&&t.hasOwnProperty("box")||t.hasOwnProperty("detection"))&&t;var t}).then(function(t){if(!1===t){if("MANUAL_CAPTURE"===p)return y=!0,M.resultCallback({warnings:{status:"failure",code:"NF",key:"NO_FACE_FOUND",score:0},imageData:e.imageData}),!1;W.NO_FACE_FOUND+=1,(G+=1)>=5&&(Q="NO_FACE_FOUND",G=0)}else G=0;return!1!==t&&t}).then(function(t){return"MANUAL_CAPTURE"!==p?Object(a.e)(t)?(G=0,z({faceDetectionWithBox:t})):((G+=1)>=5&&(G=0),{type:"NO_FACE_FOUND"}):Object(a.e)(t)?(t.imageHeight=e.imageData.height,t.imageWidth=e.imageData.width,(n={faceDetectionWithBox:t}.faceDetectionWithBox).expressions.asSortedArray()[0].expression,r=h(n.detection.box)?n.detection.box:n.detectionResult.box,i={type:"MISNAP_SUCCESS",storeFrame:!1,detectionBox:r},r.height/n.imageHeight>.7?(W.MISNAP_HEAD_TOO_CLOSE+=1,i.type="MISNAP_HEAD_TOO_CLOSE",i):Y(n.landmarks)?(W.MISNAP_HEAD_SKEWED+=1,i.type="MISNAP_HEAD_SKEWED",i):r.height/n.imageHeight<.3?(W.MISNAP_HEAD_TOO_FAR+=1,i.type="MISNAP_HEAD_TOO_FAR",i):i):!1===y?(M.resultCallback({warnings:{status:"failure",code:"NF",key:"NO_FACE_FOUND",score:0},imageData:e.imageData}),!1):void 0;var n,r,i}).then(function(t){if("MANUAL_CAPTURE"===p&&(L=e.imageData),!0===t.storeFrame){(U+=1)>=3&&(B=!0);var n=function(e,t){u.a.Fast.THRESHOLD=D;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");r.putImageData(e,0,0);var a=r.getImageData(t._x,t._y,t.width,t.height),i=u.a.Image.grayscale(a.data,a.width,a.height);return u.a.Fast.findCorners(i,a.width,a.height).length}(e.imageData,t.detectionBox);n>H&&(H=n,L=e.imageData,r.a.emit("LOG_MIBI_EVENT",{eventName:E.MitekMibiAction.AUTOCAPTURE_FAST_SCORE,eventValues:n}))}"MISNAP_SUCCESS"===t.type?(r.a.emit("LOG_MIBI_EVENT",{eventName:E.MitekMibiAction.FACE_FAILURE_COUNT,eventValues:W}),M.resultCallback({warnings:{status:"success"},imageData:L}),L=""):(r.a.emit("LOG_MIBI_EVENT",{eventName:E.MitekMibiAction.FACE_FAILURE_COUNT,eventValues:W}),M.resultCallback({imageData:L,warnings:{code:Q,status:"failure",key:t.type,score:null}}))}).catch(function(e){})},$=function(e){if(C=e,e.width>e.height){F=!0;var t=C.x+.3*C.width,n=C.x+.7*C.width-t;C.x=t,C.width=n}else F=!1},ee=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var r=e.indexOf("Edge/");return r>0&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)},te=function(){return r.a.removeListener("INNER_GUIDE_CHANGE",$)};t.default=function(e){var t=null;return M=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){_(e,t,n[t])})}return e}({},e,{ranOnce:!0}),new Promise(function(e,n){L=new ImageData(10,10),R=0,U=0,H=0,k="",B="",G=0,W.MISNAP_HEAD_TOO_CLOSE=0,W.MISNAP_HEAD_OUTSIDE=0,W.MISNAP_STAY_STILL=0,W.MISNAP_AXIS_ANGLE=0,W.MISNAP_HEAD_SKEWED=0,W.MISNAP_HEAD_TOO_FAR=0,W.NO_FACE_FOUND=0,function(){return V.apply(this,arguments)}().then(function(n){t=setInterval(function(){!0===c.e.tinyFaceDetector.isLoaded&&!0===c.e.faceExpressionNet.isLoaded&&!0===c.e.faceLandmark68TinyNet.isLoaded&&(clearInterval(t),r.a.on("INNER_GUIDE_CHANGE",$),r.a.on("SDK_STOP",te),r.a.on("SDK_ERROR",te),r.a.on("FRAME_CAPTURE_RESULT",te),setTimeout(function(){r.a.emit("ORIENTATION_CHANGE",{})},10),e({msg:"ready"}))},50)}).catch(function(e){})})}}}]);